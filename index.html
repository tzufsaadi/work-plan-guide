<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×”××“×¨×™×š ×œ×ª×›× ×•×Ÿ ×ª×•×›× ×™×•×ª ×¢×‘×•×“×” ×××©×œ×ª×™×•×ª + ××—×•×œ×œ ××“×“×™×</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Marked.js for rendering AI markdown response -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&display=swap');
        
        body {
            font-family: 'Heebo', sans-serif;
            background-color: #F3F4F6; /* gray-100 */
            color: #1F2937; /* gray-800 */
        }

        /* Chart Container Styling */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
            background-color: white;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 640px) {
            .chart-container {
                height: 300px;
            }
        }

        /* Flow Diagram Styling */
        .flow-step {
            position: relative;
            padding: 1.5rem;
            background: white;
            border-radius: 0.5rem;
            border-right: 4px solid #06B6D4;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .flow-step::after {
            content: 'â–¼';
            position: absolute;
            bottom: -1.5rem;
            left: 50%;
            transform: translateX(50%);
            color: #9CA3AF;
            font-size: 1.2rem;
        }

        .flow-step:last-child::after {
            content: none;
        }

        /* AI Section Styling */
        .ai-response-content ul {
            list-style-type: none;
            padding-right: 0;
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .ai-response-content li {
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            background-color: #F9FAFB;
            border-right: 3px solid #E5E7EB;
        }
        .ai-response-content strong {
            font-weight: 700;
            color: #1E3A8A;
            display: block;
            margin-bottom: 0.25rem;
        }

        /* Palette Classes */
        .text-primary { color: #1E3A8A; }
        .bg-primary { background-color: #1E3A8A; }
        .text-secondary { color: #06B6D4; }
        .bg-secondary { background-color: #06B6D4; }
        .text-accent { color: #F59E0B; }
        .bg-accent { background-color: #F59E0B; }
        
        /* Loading Animation */
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #06B6D4;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <!-- Header -->
    <header class="max-w-6xl mx-auto text-center mb-12">
        <h1 class="text-4xl md:text-6xl font-black text-primary mb-4">×ª×›× ×•×Ÿ ×¢×‘×•×“×” ×××©×œ×ª×™</h1>
        <h2 class="text-xl md:text-2xl text-gray-600 font-light">××“×¨×™×š ××¢×©×™ ×œ××¢×‘×¨ ×× ×™×”×•×œ ×ª×¤×•×§×•×ª ×œ× ×™×”×•×œ ×ª×•×¦××•×ª</h2>
        <div class="w-24 h-2 bg-secondary mx-auto mt-6 rounded-full"></div>
    </header>

    <main class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">

        <!-- Section 1: Introduction -->
        <section class="col-span-1 md:col-span-2 lg:col-span-3 bg-white rounded-xl shadow-lg p-8 border-t-8 border-primary">
            <h3 class="text-3xl font-bold text-gray-800 mb-6">×¢×§×¨×•× ×•×ª ×”×™×¡×•×“: ×”××”×¤×›×” ×”×ª×¤×™×¡×ª×™×ª</h3>
            <p class="text-lg text-gray-600 mb-8 leading-relaxed">
                ×ª×›× ×•×Ÿ ×××©×œ×ª×™ ××™×›×•×ª×™ ××™× ×• ×¨×©×™××ª ××›×•×œ×ª ×©×œ ××©×™××•×ª. ×”×•× ×ª×”×œ×™×š ××¡×˜×¨×˜×’×™ ×©××˜×¨×ª×• ×œ×©× ×•×ª ××¦×™××•×ª.
                ×”××ª×’×¨ ×”××¨×›×–×™ ×”×•× ×”××¢×‘×¨ ×××“×™×“×ª <strong>×ª×¤×•×§×•×ª</strong> (×›××” ×›×‘×™×©×™× ×¡×œ×œ× ×•?) ×œ××“×™×“×ª <strong>×ª×•×¦××•×ª</strong> (×›××” ×—×™×™× ×”×¦×œ× ×•?).
            </p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="bg-gray-50 p-6 rounded-lg text-center hover:shadow-md transition-shadow">
                    <div class="text-4xl mb-4">ğŸ‘ï¸</div>
                    <h4 class="font-bold text-primary text-xl mb-2">×©×§×™×¤×•×ª</h4>
                    <p class="text-sm text-gray-600">×”×ª×•×›× ×™×ª ×’×œ×•×™×” ×œ×¦×™×‘×•×¨ ×•×œ×¢×•×‘×“×™×. ××” ×©×œ× ×©×§×•×£, ×œ× ×§×™×™×.</p>
                </div>
                <div class="bg-gray-50 p-6 rounded-lg text-center hover:shadow-md transition-shadow">
                    <div class="text-4xl mb-4">ğŸ“</div>
                    <h4 class="font-bold text-primary text-xl mb-2">××“×™×“×•×ª</h4>
                    <p class="text-sm text-gray-600">××” ×©×œ× × ××“×“ â€“ ×œ× ×× ×•×”×œ. ×›×œ ×™×¢×“ ×—×™×™×‘ ××¡×¤×¨.</p>
                </div>
                <div class="bg-gray-50 p-6 rounded-lg text-center hover:shadow-md transition-shadow">
                    <div class="text-4xl mb-4">ğŸ§©</div>
                    <h4 class="font-bold text-primary text-xl mb-2">××™× ×˜×’×¨×¦×™×”</h4>
                    <p class="text-sm text-gray-600">×”×œ×™××” ××•×—×œ×˜×ª ×‘×™×Ÿ ×”××©×™××•×ª, ×”×ª×§×¦×™×‘ ×•×›×•×— ×”××“×.</p>
                </div>
                <div class="bg-gray-50 p-6 rounded-lg text-center hover:shadow-md transition-shadow">
                    <div class="text-4xl mb-4">ğŸ”„</div>
                    <h4 class="font-bold text-primary text-xl mb-2">×”××©×›×™×•×ª</h4>
                    <p class="text-sm text-gray-600">×—×™×‘×•×¨ ×”××¡×˜×¨×˜×’×™×” ××¨×•×›×ª ×”×˜×•×•×— ×œ×ª×•×›× ×™×ª ×”×©× ×ª×™×ª.</p>
                </div>
            </div>
        </section>

        <!-- Section 2: The Planning Funnel -->
        <section class="col-span-1 lg:col-span-1">
            <div class="sticky top-8">
                <h3 class="text-2xl font-bold text-primary mb-6">×”×¤×™×¨××™×“×” ×”×ª×›× ×•× ×™×ª</h3>
                <p class="text-gray-600 mb-6 text-sm">
                    ×ª×”×œ×™×š ×”×ª×›× ×•×Ÿ × ×‘× ×” ×‘×¦×•×¨×” ×”×™×¨×¨×›×™×ª, ××”×¨××” ×”××•×¤×©×˜×ª ×‘×™×•×ª×¨ (×—×–×•×Ÿ) ×•×¢×“ ×œ×¨××ª ×”×‘×™×¦×•×¢ ×”×™×•××™×•××™×ª (××©×™××•×ª).
                </p>
                
                <div class="flex flex-col">
                    <div class="flow-step">
                        <span class="absolute top-0 right-0 bg-primary text-white text-xs px-2 py-1 rounded-bl-lg">×©×œ×‘ ×'</span>
                        <h4 class="font-bold text-lg">×—×–×•×Ÿ ×•×™×™×¢×•×“ (Vision)</h4>
                        <p class="text-xs text-gray-500 mt-1">×œ××Ÿ ×× ×• ×©×•××¤×™× ×œ×”×’×™×¢ ×‘×¢×•×“ 5-10 ×©× ×™×?</p>
                    </div>
                    
                    <div class="flow-step">
                        <span class="absolute top-0 right-0 bg-primary text-white text-xs px-2 py-1 rounded-bl-lg">×©×œ×‘ ×‘'</span>
                        <h4 class="font-bold text-lg">××˜×¨×•×ª ×¢×œ (Strategic Goals)</h4>
                        <p class="text-xs text-gray-500 mt-1">×”×©×™× ×•×™ ×”××¨×›×–×™ ×©×× ×• ×¨×•×¦×™× ×œ×—×•×œ×œ.</p>
                    </div>

                    <div class="flow-step">
                        <span class="absolute top-0 right-0 bg-primary text-white text-xs px-2 py-1 rounded-bl-lg">×©×œ×‘ ×‘'</span>
                        <h4 class="font-bold text-lg">×™×¢×“×™× ××•×¤×¨×˜×™×‘×™×™×</h4>
                        <p class="text-xs text-gray-500 mt-1">×™×¢×“×™× ×§×•× ×§×¨×˜×™×™× ×”× ×’×–×¨×™× ××”××˜×¨×•×ª.</p>
                    </div>

                    <div class="flow-step !mb-0 border-r-4 border-accent">
                        <span class="absolute top-0 right-0 bg-accent text-white text-xs px-2 py-1 rounded-bl-lg">×©×œ×‘ ×“'</span>
                        <h4 class="font-bold text-lg">××©×™××•×ª (Tasks)</h4>
                        <p class="text-xs text-gray-500 mt-1">××™ ×¢×•×©×” ××”, ××ª×™ ×•×¢× ××™×–×” ×ª×§×¦×™×‘.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: AI KPI Generator -->
        <section class="col-span-1 md:col-span-1 lg:col-span-2 flex flex-col gap-6">
            
            <!-- SMART Chart -->
            <div>
                <div class="mb-4">
                    <h3 class="text-2xl font-bold text-primary">××•×“×œ SMART ×œ××“×“×™×</h3>
                    <p class="text-gray-600 mt-2">
                        ×”×—×œ×§ ×”×§×¨×™×˜×™ ×‘×™×•×ª×¨ ×‘×ª×•×›× ×™×ª ×”×•× ×”×’×“×¨×ª ×”××“×“×™×. ××“×“ ×˜×•×‘ ××™× ×• "×ª×—×•×©×ª ×‘×˜×Ÿ", ××œ× ×›×œ×™ × ×™×”×•×œ×™ ××“×•×™×§.
                    </p>
                </div>
                <div class="chart-container">
                    <canvas id="smartChart"></canvas>
                </div>
            </div>

            <!-- AI Tool -->
            <div class="bg-gradient-to-br from-indigo-50 to-white p-6 rounded-xl border border-indigo-100 shadow-lg mt-4 ring-1 ring-indigo-50 relative">
                
                <!-- API Key Toggle -->
                <button onclick="toggleApiKeyInput()" class="absolute top-4 left-4 bg-white border border-gray-200 text-gray-600 hover:text-primary hover:border-primary px-3 py-1 rounded-full text-xs font-bold shadow-sm transition-all flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    ×”×’×“×¨ ××¤×ª×—
                </button>

                <!-- API Key Input Section (Hidden by default) -->
                <div id="apiKeySection" class="hidden mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200 mt-8">
                    <label class="block text-sm font-bold text-gray-700 mb-2">××¤×ª×— Gemini API</label>
                    <input type="password" id="userApiKey" placeholder="×”×“×‘×§ ×›××Ÿ ××ª ×”××¤×ª×— (AIza...)" class="w-full p-2 border border-gray-300 rounded mb-2 text-sm">
                    <p class="text-xs text-gray-500 mb-2">
                        ×”××¤×ª×— × ×©××¨ ×‘×“×¤×“×¤×Ÿ ×©×œ×š ×‘×œ×‘×“. ×•×•×“× ×©××™×Ÿ ×¨×•×•×—×™× ×‘×”×¢×ª×§×”.
                        <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-primary underline font-bold">×”×©×’ ××¤×ª×— ×‘×—×™× × ×›××Ÿ</a>.
                    </p>
                    <div class="flex gap-2">
                        <button onclick="saveApiKey()" class="bg-green-600 text-white px-3 py-1 rounded text-xs hover:bg-green-700">×©××•×¨ ×•×”××©×š</button>
                        <button onclick="clearApiKey()" class="bg-red-100 text-red-600 border border-red-200 px-3 py-1 rounded text-xs hover:bg-red-200">××—×§ ××¤×ª×— ×©××•×¨</button>
                    </div>
                </div>

                <div class="flex items-center gap-3 mb-4 border-b border-indigo-100 pb-3 pt-2">
                    <div class="bg-white p-2 rounded-full shadow-sm text-2xl">ğŸ¤–</div>
                    <div>
                        <h4 class="text-xl font-bold text-primary">××—×•×œ×œ ××“×“×™ ×ª×¤×•×§×” vs ×ª×•×¦××”</h4>
                        <p class="text-xs text-gray-500">××•×¤×¢×œ ×¢×œ ×™×“×™ ×‘×™× ×” ××œ××›×•×ª×™×ª</p>
                    </div>
                </div>
                
                <p class="text-sm text-gray-700 mb-4 leading-relaxed">
                    ××ª×œ×‘×˜×™× ××” ×”×”×‘×“×œ ×‘×™×Ÿ <strong>××” ×©×¢×©×™×ª×</strong> ×œ×‘×™×Ÿ <strong>××” ×©×”×©×’×ª×</strong>?
                    <br>×”×§×œ×™×“×• ××©×™××” ××• ××˜×¨×” (×œ××©×œ: "×”×›×©×¨×ª ×¢×•×‘×“×™×", "×©×™×¤×•×¨ ×ª×©×ª×™×•×ª"), ×•×”××¢×¨×›×ª ×ª×™×™×¦×¨ ×¢×‘×•×¨×›× ×“×•×’××” ×œ××“×“ ×ª×¤×•×§×” ×•××“×“ ×ª×•×¦××”.
                </p>
                
                <div class="flex flex-col gap-3">
                    <input type="text" id="aiInput" placeholder="×”×§×œ×™×“×• ×›××Ÿ × ×•×©× (×œ×“×•×’××”: ×—×™× ×•×š ×˜×›× ×•×œ×•×’×™)..." class="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent shadow-sm transition-all text-gray-800 bg-white">
                    
                    <button onclick="generateKPI()" id="aiBtn" class="w-full bg-primary text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-800 transition-all shadow-md active:scale-95 flex items-center justify-center gap-2">
                        <span id="aiBtnText">×¦×•×¨ ×”×©×•×•××ª ××“×“×™×</span>
                        <div id="aiLoader" class="loader hidden"></div>
                    </button>
                </div>

                <!-- Result Container -->
                <div id="aiResultContainer" class="mt-6 hidden">
                    <h5 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-2">×”×¦×¢×ª ×”××¢×¨×›×ª:</h5>
                    <div id="aiResult" class="p-5 bg-white rounded-lg border border-gray-200 text-sm text-gray-700 ai-response-content shadow-inner">
                        <!-- AI Response will go here -->
                    </div>
                </div>
                
                <div id="aiError" class="mt-4 hidden p-3 bg-red-50 text-red-600 text-sm rounded border border-red-100 flex items-center gap-2">
                    <span id="aiErrorText">âš ï¸ ××™×¨×¢×” ×©×’×™××”.</span>
                </div>
            </div>
        </section>

        <!-- Section 4: Outcome vs Output -->
        <section class="col-span-1 md:col-span-2 lg:col-span-3 bg-white rounded-xl shadow-lg p-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
                <div>
                    <h3 class="text-2xl font-bold text-primary mb-4">×ª×¤×•×§×” (Output) ××•×œ ×ª×•×¦××” (Outcome)</h3>
                    <p class="text-gray-600 mb-4 leading-relaxed">
                        ×”×˜×¢×•×ª ×”× ×¤×•×¦×” ×‘×™×•×ª×¨ ×‘×ª×›× ×•×Ÿ ×¦×™×‘×•×¨×™ ×”×™× ×‘×œ×‘×•×œ ×‘×™×Ÿ ×¢×©×™×™×” ×œ×”×©×¤×¢×”.
                        ×‘×“×•×’××” ××©×××œ (×‘×˜×™×—×•×ª ×‘×“×¨×›×™×), ×× ×• ×¨×•××™× ×©××™×Ÿ ×§×©×¨ ×™×©×™×¨ ×‘×™×Ÿ ×›××•×ª ×”××¡×¤×œ×˜ ×©× ×¡×œ×œ (×ª×¤×•×§×”) ×œ×‘×™×Ÿ ××¡×¤×¨ ×”×ª××•× ×•×ª (×ª×•×¦××”).
                    </p>
                    <ul class="space-y-3 mb-6">
                        <li class="flex items-start">
                            <span class="text-red-500 font-bold ml-2">âœ•</span>
                            <span><strong>××“×“ ×ª×¤×•×§×” ×©×’×•×™:</strong> "×¡×œ×œ× ×• 50 ×§×™×œ×•××˜×¨ ×›×‘×™×© ×”×©× ×”." (××– ××”?)</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-500 font-bold ml-2">âœ“</span>
                            <span><strong>××“×“ ×ª×•×¦××” × ×›×•×Ÿ:</strong> "×”×¤×—×ª× ×• ××ª ××¡×¤×¨ ×”×”×¨×•×’×™× ×‘-5%." (×–×• ×”××˜×¨×”!)</span>
                        </li>
                    </ul>
                </div>
                <div class="chart-container">
                    <canvas id="outcomeChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Section 5: Consultants -->
        <section class="col-span-1 md:col-span-2 lg:col-span-3">
            <h3 class="text-2xl font-bold text-primary mb-6 border-b pb-2">×ª×¤×§×™×“ ×—×‘×¨×•×ª ×”×™×™×¢×•×¥ ×‘×ª×•×›× ×™×ª ×”×¢×‘×•×“×”</h3>
            <p class="text-gray-600 mb-6">
                ×©×™×œ×•×‘ ×™×•×¢×¦×™× ×—×™×¦×•× ×™×™× ×”×•× ×›×œ×™ ×¨×‘ ×¢×•×¦××”, ××š ×“×•×¨×© × ×™×”×•×œ ×¡×™×›×•× ×™×. ×”××™×–×•×Ÿ ×”× ×›×•×Ÿ ×”×•× ×‘×™×Ÿ ×§×‘×œ×ª ××ª×•×“×•×œ×•×’×™×” ×•× ×ª×•× ×™× ××”×™×•×¢×¥, ×œ×‘×™×Ÿ ×©××™×¨×ª ×”××—×¨×™×•×ª ×•×”×”×•×‘×œ×” ×‘×™×“×™ ×”××©×¨×“.
            </p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Value Add Card -->
                <div class="bg-blue-50 p-6 rounded-lg border-r-4 border-blue-500">
                    <h4 class="text-xl font-bold text-blue-900 mb-4 flex items-center">
                        <span class="text-2xl ml-2">ğŸš€</span> ×”×¢×¨×š ×”××•×¡×£ ×©×œ ×”×™×•×¢×¥
                    </h4>
                    <ul class="space-y-3 text-gray-700">
                        <li class="flex items-start">
                            <span class="bg-blue-200 text-blue-800 text-xs font-bold px-2 py-1 rounded ml-2 mt-1">××ª×•×“×•×œ×•×’×™×”</span>
                            <span>×”×‘××ª ×ª×‘× ×™×•×ª ×¢×‘×•×“×” ×•×©×¤×” ××—×™×“×” ×œ××¨×’×•×Ÿ (PMO).</span>
                        </li>
                        <li class="flex items-start">
                            <span class="bg-blue-200 text-blue-800 text-xs font-bold px-2 py-1 rounded ml-2 mt-1">×‘× ×¦'×××¨×§</span>
                            <span>×”×©×•×•××” ×œ××©×¨×“×™× ××§×‘×™×œ×™× ×‘×¢×•×œ× (OECD) ×•×œ××™×“×” ××”×¦×œ×—×•×ª.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="bg-blue-200 text-blue-800 text-xs font-bold px-2 py-1 rounded ml-2 mt-1">××™×§×•×“</span>
                            <span>"××™×ª×’×•×¨" ×”×× ×”×œ×™× ×•×–×™×§×•×§ ××˜×¨×•×ª ×—×“×•×ª ×•××“×™×“×•×ª.</span>
                        </li>
                    </ul>
                </div>

                <!-- Ownership Card -->
                <div class="bg-amber-50 p-6 rounded-lg border-r-4 border-amber-500">
                    <h4 class="text-xl font-bold text-amber-900 mb-4 flex items-center">
                        <span class="text-2xl ml-2">âš ï¸</span> × ×™×”×•×œ ×¡×™×›×•×Ÿ: ×‘×¢×œ×•×ª (Ownership)
                    </h4>
                    <ul class="space-y-3 text-gray-700">
                        <li class="flex items-start">
                            <span class="bg-amber-200 text-amber-900 text-xs font-bold px-2 py-1 rounded ml-2 mt-1">×”×× ×”×œ ××—×œ×™×˜</span>
                            <span>×”×™×•×¢×¥ ×¨×§ ×××œ×™×¥. ×”××—×¨×™×•×ª ×œ×‘×™×¦×•×¢ × ×©××¨×ª ××¦×œ ×”×“×¨×’ ×”×× ×”×œ.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="bg-amber-200 text-amber-900 text-xs font-bold px-2 py-1 rounded ml-2 mt-1">×”×˜××¢×”</span>
                            <span>×—×•×‘×” ×œ×©×ª×£ ××ª ×× ×©×™ ×”××©×¨×“ ×‘×ª×”×œ×™×š ×›×“×™ ×©×”×™×“×¢ ×œ× ×™×¢×–×•×‘ ×¢× ×”×™×•×¢×¥.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="bg-amber-200 text-amber-900 text-xs font-bold px-2 py-1 rounded ml-2 mt-1">×–×”×•×ª</span>
                            <span>×”×ª×•×›× ×™×ª ×—×™×™×‘×ª ×œ×”×™×•×ª "×©×œ ×”××©×¨×“" ×•×œ× "×©×œ ×—×‘×¨×ª ×”×™×™×¢×•×¥".</span>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Section 6: Timeline & Control -->
        <section class="col-span-1 md:col-span-2 lg:col-span-3 mt-8">
            <h3 class="text-2xl font-bold text-primary mb-6 text-center">×©×’×¨×•×ª × ×™×”×•×œ ×•×‘×§×¨×” (Gantt)</h3>
            <div class="chart-container" style="max-width: 800px;">
                <canvas id="timelineChart"></canvas>
            </div>
        </section>

        <!-- Footer -->
        <footer class="col-span-1 md:col-span-2 lg:col-span-3 text-center text-gray-400 text-sm mt-8 border-t pt-6">
            <p>× ×•×¦×¨ ×¢×œ ×‘×¡×™×¡ ×”××ª×•×“×•×œ×•×’×™×” ×©×œ ××©×¨×“ ×¨××© ×”×××©×œ×” ×œ×ª×›× ×•×Ÿ ×¢×‘×•×“×” | ×›×•×œ×œ ×× ×•×¢ ×‘×™× ×” ××œ××›×•×ª×™×ª</p>
        </footer>

    </main>

    <script>
        // --- Gemini API Configuration ---
        const apiKey = ""; // Keep empty

        // --- UI Functions for API Key ---
        function toggleApiKeyInput() {
            const section = document.getElementById('apiKeySection');
            section.classList.toggle('hidden');
        }

        function saveApiKey() {
            const inputVal = document.getElementById('userApiKey').value;
            // Sanitization: Remove whitespace and newlines
            const cleanKey = inputVal.trim().replace(/\s/g, '');
            
            if (cleanKey.length > 20 && cleanKey.startsWith('AIza')) {
                localStorage.setItem('gemini_api_key', cleanKey);
                alert('×”××¤×ª×— × ×©××¨ ×‘×”×¦×œ×—×”! (×ª×•×•×™× ××™×•×ª×¨×™× ×”×•×¡×¨×• ××•×˜×•××˜×™×ª)');
                toggleApiKeyInput();
            } else {
                alert('×”××¤×ª×— × ×¨××” ×œ× ×ª×§×™×Ÿ. ×”×•× ×—×™×™×‘ ×œ×”×ª×—×™×œ ×‘-AIza. ×× × ×‘×“×•×§ ×©× ×™×ª.');
            }
        }

        function clearApiKey() {
            localStorage.removeItem('gemini_api_key');
            document.getElementById('userApiKey').value = '';
            alert('×”××¤×ª×— × ××—×§.');
        }

        // Load saved key on startup
        document.addEventListener('DOMContentLoaded', () => {
            const savedKey = localStorage.getItem('gemini_api_key');
            if (savedKey) {
                document.getElementById('userApiKey').value = savedKey;
            }
        });

        // --- Fetch Helper with Fallback ---
        async function fetchGemini(model, key, payload) {
            // Ensure key is clean before sending
            const cleanKey = key.trim().replace(/\s/g, '');
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${cleanKey}`;
            return fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
        }

        async function generateKPI() {
            const input = document.getElementById('aiInput').value;
            const resultContainer = document.getElementById('aiResultContainer');
            const resultDiv = document.getElementById('aiResult');
            const errorDiv = document.getElementById('aiError');
            const errorText = document.getElementById('aiErrorText');
            const btnText = document.getElementById('aiBtnText');
            const loader = document.getElementById('aiLoader');

            if (!input.trim()) {
                alert("×× × ×”×–×™× ×• × ×•×©× ××• ××˜×¨×”");
                return;
            }

            // Determine which key to use
            let rawKey = apiKey; 
            if (!rawKey) {
                rawKey = localStorage.getItem('gemini_api_key') || document.getElementById('userApiKey').value;
            }

            if (!rawKey) {
                alert("×œ× × ××¦× ××¤×ª×— API. ×× × ×œ×—×¥ ×¢×œ ×›×¤×ª×•×¨ '×”×’×“×¨ ××¤×ª×—' ×•×”×–×Ÿ ××ª ×”××¤×ª×— ×©×œ×š ××’×•×’×œ.");
                const section = document.getElementById('apiKeySection');
                section.classList.remove('hidden');
                return;
            }

            // Clean Key again just to be safe
            const activeKey = rawKey.trim().replace(/\s/g, '');

            // UI State: Loading
            resultContainer.classList.add('hidden');
            errorDiv.classList.add('hidden');
            btnText.classList.add('hidden');
            loader.classList.remove('hidden');

            const systemPrompt = `
                ××ª×” ××•××—×” ×œ×ª×›× ×•×Ÿ ××¡×˜×¨×˜×’×™ ×•××“×™× ×™×•×ª ×¦×™×‘×•×¨×™×ª.
                ×”××©×™××” ×©×œ×š ×”×™× ×œ×¢×–×•×¨ ×œ××©×ª××© ×œ×”×‘×™×Ÿ ××ª ×”×”×‘×“×œ ×‘×™×Ÿ "×ª×¤×•×§×”" (Output) ×œ"×ª×•×¦××”" (Outcome) ×¢×‘×•×¨ ×”× ×•×©× ×©×”×•× ×”×–×™×Ÿ.

                ×¢×‘×•×¨ ×”× ×•×©× ×©×”××©×ª××© ×”×–×™×Ÿ, ×¦×•×¨ ×ª×©×•×‘×” ×‘×¤×•×¨××˜ Markdown ×”×›×•×œ×œ×ª:
                1. **××“×“ ×ª×¤×•×§×” (Output Indicator):** ×“×•×’××” ×œ××“×“ ×”××•×“×“ ××ª ×”×¤×¢×™×œ×•×ª ×¢×¦××” (××” ×¢×©×™× ×•? ×›××” ×™×¦×¨× ×•?). ×”×“×’×© ×©×–×” ××•×“×“ ×›××•×ª/×‘×™×¦×•×¢.
                2. **××“×“ ×ª×•×¦××” (Outcome Indicator):** ×“×•×’××” ×œ××“×“ ×”××•×“×“ ××ª ×”×©×™× ×•×™ ××• ×”×”×©×¤×¢×” (××” ×”×©×ª× ×” ×‘××¦×™××•×ª? ××” ×”×¢×¨×š ×œ×¦×™×‘×•×¨?). ×”×“×’×© ×©×–×” ××•×“×“ ××™×›×•×ª/×”×©×¤×¢×”.
                3. **×”×¡×‘×¨ ×§×¦×¨:** ××©×¤×˜ ××—×“ ×©××¡×‘×™×¨ ××ª ×”×”×‘×“×œ ×”××”×•×ª×™ ×‘××§×¨×” ×”×¡×¤×¦×™×¤×™ ×”×–×”.

                ×©××•×¨ ×¢×œ ×ª×©×•×‘×” ×§×¦×¨×”, ××§×¦×•×¢×™×ª ×•×‘×¢×‘×¨×™×ª. ×”×©×ª××© ×‘×‘×•×œ×™×˜×™× ×œ×¤×•×¨××˜ ×‘×¨×•×¨.
            `;

            const userQuery = `×”× ×•×©× ×”×•×: ${input}`;
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] }
            };

            try {
                // Try Primary Model: gemini-1.5-flash
                let response = await fetchGemini('gemini-1.5-flash', activeKey, payload);

                // If 404 (Model Not Found), try Fallback: gemini-pro
                if (response.status === 404) {
                    console.warn("Primary model not found (404), trying fallback to gemini-pro...");
                    response = await fetchGemini('gemini-pro', activeKey, payload);
                }

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    console.error("API Error Details:", errorData);
                    
                    let friendlyMsg = `×©×’×™××” (${response.status}). `;
                    
                    if (response.status === 404) {
                        friendlyMsg = "×©×’×™××” 404: ×”××•×“×œ ×œ× × ××¦×. ×”××¤×ª×— ×›× ×¨××” ×ª×§×™×Ÿ, ××š ×™×™×ª×›×Ÿ ×©×™×© ×‘×¢×™×™×ª ×’×™×©×” ×œ××•×“×œ ×–×” ×‘×—×©×‘×•× ×š.";
                    } else if (response.status === 400) {
                        friendlyMsg = "×©×’×™××” 400: ×”××¤×ª×— ××™× ×• ×ª×§×™×Ÿ (Invalid Key). × ×¡×” ×œ×œ×—×•×¥ ×¢×œ '××—×§ ××¤×ª×— ×©××•×¨' ×•×œ×”×–×™×Ÿ ××—×“×©.";
                    } else if (response.status === 403) {
                         friendlyMsg = "××™×Ÿ ×”×¨×©××” (403). ×•×•×“××• ×©×”××¤×ª×— ×¤×¢×™×œ ×‘-Google AI Studio.";
                         const section = document.getElementById('apiKeySection');
                         section.classList.remove('hidden');
                    }
                    
                    throw new Error(friendlyMsg);
                }

                const data = await response.json();
                const aiText = data.candidates?.[0]?.content?.parts?.[0]?.text;

                if (aiText) {
                    resultDiv.innerHTML = marked.parse(aiText);
                    resultContainer.classList.remove('hidden');
                } else {
                    throw new Error('×œ× ×”×ª×§×‘×œ×” ×ª×©×•×‘×” ××”××•×“×œ');
                }

            } catch (error) {
                console.error("Gemini Error:", error);
                errorText.innerText = error.message || "××™×¨×¢×” ×©×’×™××” ×œ× ×¦×¤×•×™×”.";
                errorDiv.classList.remove('hidden');
            } finally {
                // UI State: Reset
                btnText.classList.remove('hidden');
                loader.classList.add('hidden');
            }
        }

        // --- Chart Utilities ---

        function wrapLabel(label) {
            if (typeof label !== 'string' || label.length <= 16) return label;
            const words = label.split(' ');
            const lines = [];
            let currentLine = words[0];

            for (let i = 1; i < words.length; i++) {
                if ((currentLine + " " + words[i]).length <= 16) {
                    currentLine += " " + words[i];
                } else {
                    lines.push(currentLine);
                    currentLine = words[i];
                }
            }
            lines.push(currentLine);
            return lines;
        }

        function processLabels(labels) {
            return labels.map(label => wrapLabel(label));
        }

        const commonTooltipOptions = {
            callbacks: {
                title: function(tooltipItems) {
                    const item = tooltipItems[0];
                    let label = item.chart.data.labels[item.dataIndex];
                    if (Array.isArray(label)) {
                        return label.join(' ');
                    } else {
                        return label;
                    }
                }
            }
        };

        // --- Chart 1: SMART Radar Chart ---
        const ctxSmart = document.getElementById('smartChart').getContext('2d');
        const smartLabels = ["×¡×¤×¦×™×¤×™ (Specific)", "××“×™×“ (Measurable)", "×‘×¨ ×”×©×’×” (Achievable)", "×¨×œ×•×•× ×˜×™ (Relevant)", "×ª×—×•× ×‘×–××Ÿ (Time-bound)"];
        
        new Chart(ctxSmart, {
            type: 'radar',
            data: {
                labels: processLabels(smartLabels),
                datasets: [{
                    label: '×¦×™×•×Ÿ ××™×›×•×ª ×”××“×“',
                    data: [90, 85, 80, 95, 100],
                    fill: true,
                    backgroundColor: 'rgba(6, 182, 212, 0.2)',
                    borderColor: '#06B6D4',
                    pointBackgroundColor: '#1E3A8A',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#1E3A8A'
                }]
            },
            options: {
                maintainAspectRatio: false,
                responsive: true,
                plugins: {
                    legend: { display: false },
                    tooltip: commonTooltipOptions
                },
                scales: {
                    r: {
                        angleLines: { color: '#E5E7EB' },
                        grid: { color: '#E5E7EB' },
                        pointLabels: {
                            font: { family: 'Heebo', size: 12 },
                            color: '#374151'
                        },
                        suggestedMin: 0,
                        suggestedMax: 100
                    }
                }
            }
        });

        // --- Chart 2: Outcome vs Output (Mixed Chart) ---
        const ctxOutcome = document.getElementById('outcomeChart').getContext('2d');
        const years = ['2019', '2020', '2021', '2022', '2023'];

        new Chart(ctxOutcome, {
            type: 'bar',
            data: {
                labels: processLabels(years),
                datasets: [
                    {
                        type: 'line',
                        label: '××¡×¤×¨ ×ª××•× ×•×ª (×ª×•×¦××”)',
                        data: [420, 380, 410, 350, 320],
                        borderColor: '#F59E0B', 
                        backgroundColor: '#F59E0B',
                        borderWidth: 3,
                        tension: 0.4,
                        yAxisID: 'y1'
                    },
                    {
                        type: 'bar',
                        label: '×§"× ×›×‘×™×© ×©× ×¡×œ×œ (×ª×¤×•×§×”)',
                        data: [50, 120, 80, 150, 200],
                        backgroundColor: '#1E3A8A', 
                        borderRadius: 4,
                        yAxisID: 'y'
                    }
                ]
            },
            options: {
                maintainAspectRatio: false,
                responsive: true,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                plugins: {
                    tooltip: commonTooltipOptions,
                    legend: { position: 'bottom', labels: { font: { family: 'Heebo' } } }
                },
                scales: {
                    x: { grid: { display: false } },
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: { display: true, text: '×§"× ×¡×œ×™×œ×”' },
                        grid: { color: '#F3F4F6' }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        title: { display: true, text: '××¡×¤×¨ ×ª××•× ×•×ª' },
                        grid: { drawOnChartArea: false }
                    }
                }
            }
        });

        // --- Chart 3: Timeline / Control Cycle (Floating Bars) ---
        const ctxTimeline = document.getElementById('timelineChart').getContext('2d');
        const tasks = ["×ª×›× ×•×Ÿ ××¡×˜×¨×˜×’×™", "××™×©×•×¨ ×ª×§×¦×™×‘", "×‘×™×¦×•×¢ Q1-Q2", "×‘×§×¨×” ×—×¦×™ ×©× ×ª×™×ª", "×‘×™×¦×•×¢ Q3-Q4", "×¡×™×›×•× ×©× ×”"];
        const timelineData = [[0, 2], [1, 3], [3, 6], [6, 7], [7, 12], [11, 12]];

        new Chart(ctxTimeline, {
            type: 'bar',
            data: {
                labels: processLabels(tasks),
                datasets: [{
                    label: '×—×•×“×©×™ ×¤×¢×™×œ×•×ª',
                    data: timelineData,
                    backgroundColor: ['#9CA3AF', '#F59E0B', '#06B6D4', '#1E3A8A', '#06B6D4', '#1E3A8A'],
                    borderRadius: 4,
                    barPercentage: 0.6
                }]
            },
            options: {
                indexAxis: 'y',
                maintainAspectRatio: false,
                responsive: true,
                plugins: {
                    tooltip: {
                        callbacks: {
                            title: commonTooltipOptions.callbacks.title,
                            label: function(context) {
                                const raw = context.raw;
                                return `×—×•×“×©×™×: ${raw[0] + 1} - ${raw[1]}`;
                            }
                        }
                    },
                    legend: { display: false }
                },
                scales: {
                    x: {
                        min: 0,
                        max: 12,
                        grid: { color: '#F3F4F6' },
                        ticks: {
                            stepSize: 1,
                            callback: function(value) {
                                const months = ["×™× ×•", "×¤×‘×¨", "××¨×¥", "××¤×¨", "×××™", "×™×•× ×™", "×™×•×œ×™", "××•×’", "×¡×¤×˜", "××•×§", "× ×•×‘", "×“×¦×"];
                                return months[value] || '';
                            }
                        }
                    },
                    y: { grid: { display: false } }
                }
            }
        });
    </script>
</body>
</html>
